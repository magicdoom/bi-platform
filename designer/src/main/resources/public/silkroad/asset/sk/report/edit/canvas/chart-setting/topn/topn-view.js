define(["dialog","report/edit/canvas/chart-setting/topn/topn-model","report/edit/canvas/chart-setting/topn/topn-setting-template"],function(a,b,c){a.confirm;var d=Backbone.View.extend({events:{"click .j-set-topn":"getTopnList"},initialize:function(a){var c=this;c.model=new b({canvasModel:a.canvasView.model,reportId:a.reportId}),this.model.set("compId",this.$el.find(".j-comp-setting").attr("data-comp-id"))},getTopnList:function(){var a=this;a.model.getTopnList(function(b){a._openTopnDialog(b)})},destroy:function(){this.stopListening(),this.model.clear({silent:!0}),delete this.model,this.$el.unbind()},_openTopnDialog:function(b){var d,e=this;return b.indList?(d=c.render(b),a.showDialog({title:"topn设置",content:d,dialog:{width:340,height:300,resizable:!1,buttons:[{text:"提交",click:function(){e._saveTopnFormInfo($(this))}},{text:"取消",click:function(){$(this).dialog("close")}}]}}),void 0):(a.alert("没有指标"),void 0)},_saveTopnFormInfo:function(a){var b=$(".topn-indlist").find("select"),c=$(".topn-indlist").find("input"),d={};b.each(function(){var a=$(this),b=a.attr("name");d[b]=a.val()}),d[c.attr("name")]=c.val(),this.model.saveTopnInfo(d,function(){a.dialog("close"),window.dataInsight.main.canvas.showReport()})}});return d});