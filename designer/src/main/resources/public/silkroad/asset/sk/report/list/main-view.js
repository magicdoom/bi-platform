define(["template","dialog","report/list/main-model","report/list/main-template","report/list/set-name-template","report/report-view"],function(a,b,c,d,e,f){return Backbone.View.extend({events:{"click .j-add-report":"addReport","click .j-show-publish-info":"showPublishInfo","click .j-delete-report":"deleteReport","click .j-edit-report":"editReport","click .j-copy-report":"copyReport","click .j-show-report":"showReport"},initialize:function(){var a=this;a.model=new c,a.reportView=new f,a.listenTo(a.model,"change:reportList",function(b,c){return null==c?(window.location.href="home.html",void 0):(a.$el.html(d.render({reportList:c})),void 0)}),this.model.loadReportList(),window.dataInsight.main=this},addReport:function(){var a=this;this.openSetNameDialog({title:"添加报表",data:{text:"报表名称"},submit:function(b){var c=$(b),d=c.find(".j-report-name").val();""==d?c.find(".j-validation").html("名称不能为空").show():a.model.addReport(d,function(a){c.dialog("close"),require(["report/set-cube/cube-view"],function(b){window.dataInsight.main.destroy(),new b({el:$(".j-main"),id:a})})},function(a){c.find(".j-validation").html(a).show()})}})},editReport:function(a){var b=this.getLineId(a),c=this.getReportTheme(a),d=this;require(["report/edit/main-view"],function(a){d.destroy(),window.dataInsight.main=new a({el:$(".j-main"),id:b,isEdit:!0,theme:c})}),$(".link-skin").attr("href","asset/"+c+"/css/-di-product-min.css")},showReport:function(a){var b=this,c=this.getLineId(a);b.model.showReport(c,function(a){window.open(a,"_blank",left=0,top=0)})},deleteReport:function(a){var c=this,d=this.getLineId(a);b.confirm("是否确定删除当前报表",function(){c.model.deleteReport(d)})},copyReport:function(a){var b=this,c=this.getLineId(a);this.openSetNameDialog({title:"添加报表",data:{text:"请给新表单命名",name:this.getNameById(c)+" - 副本"},submit:function(a){var d=$(a),e=d.find(".j-report-name").val().trim();""==e?d.find(".j-validation").html("名称不能为空").show():b.model.copyReport(c,e,function(){d.dialog("close")},function(a){d.find(".j-validation").html(a).show()})}})},getLineId:function(a){return $(a.target).parents(".j-root-line").attr("data-id")},getReportTheme:function(a){return $(a.target).parents(".j-root-line").attr("data-theme")},openSetNameDialog:function(a){b.showDialog({title:a.title,content:e.render(a.data),dialog:{width:300,height:249,open:function(){var a=$(this);a.find(".j-report-name").focus(function(){a.find(".j-validation").hide()})},buttons:[{text:"提交",click:function(){a.submit(this)}},{text:"取消",click:function(){$(this).dialog("close")}}]}})},getNameById:function(a){for(var b=this.model.get("reportList"),c=0,d=b.length;d>c;c++)if(a==b[c].id)return b[c].name},showPublishInfo:function(a){var b=this.getLineId(a);this.reportView.publishReport("GET",b)},destroy:function(){this.model.clear({silent:!0}),this.stopListening(),$(this.el).unbind().empty()}})});